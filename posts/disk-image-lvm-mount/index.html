<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="How to mount partition from xen instance This below describes the way to mount an LVM partition that exists within a partition from a multi-partition disk image.
Let assume our image is called System.img
We will need losetup, kpartx and vgscan,vgchange commands.
With losetup -f you will identify free loopback devices. let say this is loop6.
losetup /dev/loop6 ./System.img This will mount the disk image in the loop device.
" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://apostoloss.github.io/BitsThoughtsAndMore/posts/disk-image-lvm-mount/" />


    <title>
        
            Partition From Xen Instance :: a blog with Hugo  — ...lost bits..
        
    </title>





  <link rel="stylesheet" href="/BitsThoughtsAndMore/main.min.7289daf2e88ea2c7b253a51cc5794c7cc17e7aeb7295a19d978db764a5862f25.css" integrity="sha256-cona8uiOoseyU6UcxXlMfMF&#43;eutylaGdl423ZKWGLyU=" crossorigin="anonymous">





    <link rel="apple-touch-icon" sizes="180x180" href="/BitsThoughtsAndMore/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/BitsThoughtsAndMore/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/BitsThoughtsAndMore/favicon-16x16.png">
    <link rel="manifest" href="/BitsThoughtsAndMore/site.webmanifest">
    <link rel="mask-icon" href="/BitsThoughtsAndMore/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/BitsThoughtsAndMore/favicon.ico">
    <meta name="msapplication-TileColor" content="">



  <meta itemprop="name" content="Partition From Xen Instance">
  <meta itemprop="description" content="How to mount partition from xen instance This below describes the way to mount an LVM partition that exists within a partition from a multi-partition disk image.
Let assume our image is called System.img
We will need losetup, kpartx and vgscan,vgchange commands.
With losetup -f you will identify free loopback devices. let say this is loop6.
losetup /dev/loop6 ./System.img This will mount the disk image in the loop device.">
  <meta itemprop="datePublished" content="2019-04-01T16:58:19+03:00">
  <meta itemprop="dateModified" content="2019-04-01T16:58:19+03:00">
  <meta itemprop="wordCount" content="309">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Partition From Xen Instance">
  <meta name="twitter:description" content="How to mount partition from xen instance This below describes the way to mount an LVM partition that exists within a partition from a multi-partition disk image.
Let assume our image is called System.img
We will need losetup, kpartx and vgscan,vgchange commands.
With losetup -f you will identify free loopback devices. let say this is loop6.
losetup /dev/loop6 ./System.img This will mount the disk image in the loop device.">







    <meta property="article:published_time" content="2019-04-01 16:58:19 &#43;0300 EEST" />












    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                :{}: &lt;</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
                <nav class="menu">
    <ul class="menu__inner">
                <li><a href="/BitsThoughtsAndMore/about">About</a></li>
            
                <li><a href="/BitsThoughtsAndMore/notes">notes</a></li>
            
                <li><a href="/BitsThoughtsAndMore/posts">posts</a></li>
            
                <li><a href="/BitsThoughtsAndMore/quotes">quotes</a></li>
            
                <li><a href="/BitsThoughtsAndMore/stories">stories</a></li>
            
    </ul>
</nav>


                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
        </span>
    </span>
</header>


            
  <div class="content">
    <main class="post">

      <div class="post-info">
        <p>

          
        </p>
      </div>

      <article>
        <h1 class="post-title">
          <a href="https://apostoloss.github.io/BitsThoughtsAndMore/posts/disk-image-lvm-mount/">Partition From Xen Instance</a>
        </h1>

        

        

        

        <div class="post-content">
          <h1 id="how-to-mount-partition-from-xen-instance">How to mount partition from xen instance</h1>
<p>This below describes the way to mount an LVM partition that exists within a
partition from a multi-partition disk image.</p>
<p>Let assume our image is called System.img</p>
<p>We will need losetup, kpartx and vgscan,vgchange commands.</p>
<p>With losetup -f you will identify free loopback devices.
let say this is loop6.</p>
<ol>
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>losetup /dev/loop6 ./System.img
</span></span></code></pre></div></li>
</ol>
<p>This will mount the disk image in the loop device.</p>
<p>You can see partition info with</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>fdisk -l /dev/loop6
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disk /dev/loop6: 82.6 GB, <span style="color:#ae81ff">82678120448</span> bytes
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">255</span> heads, <span style="color:#ae81ff">63</span> sectors/track, <span style="color:#ae81ff">10051</span> cylinders
</span></span><span style="display:flex;"><span>Units <span style="color:#f92672">=</span> cylinders of <span style="color:#ae81ff">16065</span> * 512 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8225280</span> bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      Device Boot      Start         End      Blocks   Id  System
</span></span><span style="display:flex;"><span>/dev/loop6p1   *           <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">66</span>      <span style="color:#ae81ff">524288</span>   <span style="color:#ae81ff">83</span>  Linux
</span></span><span style="display:flex;"><span>Partition <span style="color:#ae81ff">1</span> does not end on cylinder boundary.
</span></span><span style="display:flex;"><span>/dev/loop6p2              <span style="color:#ae81ff">66</span>       <span style="color:#ae81ff">10051</span>    80209345+  8e  Linux LVM
</span></span></code></pre></div><p>You could possibly remove the loopback mount and remount only the partition you
want from the total disk by using the offset &lsquo;&rsquo;&rsquo;-o&rsquo;&rsquo;&rsquo; option.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>losetup -d /dev/loop6
</span></span></code></pre></div><p>offset is the start cylinder multiplied by the size of each, here 512, so
(start of p2) 66* (512 bytes) 512 = offset is 33792</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>losetup /dev/loop6 System.img -o <span style="color:#ae81ff">33792</span>
</span></span></code></pre></div><p>However, we will not use that option.</p>
<p>Instead:</p>
<ol start="2">
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> kpartx -a /dev/loop6
</span></span></code></pre></div></li>
</ol>
<p>which will create the /dev/mapper/loopXpY devices for all partitions of image</p>
<ol start="3">
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>vgscan
</span></span></code></pre></div></li>
</ol>
<p>this will show the volume groups that exists in all the devices
(so eventually search those created above).
In our example it returned (in addition to others) the <em>vg_apol</em></p>
<ol start="4">
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>vgchange -ay vg_apol
</span></span></code></pre></div></li>
</ol>
<p>This creates the /dev/<!-- raw HTML omitted -->/&lt;logical_volume&gt; devices so we can mount.</p>
<ol start="5">
<li>finally mount the one we need</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mount /dev/vg_apol/lv_root ./second/
</span></span></code></pre></div><p>After doing what we want with the mounted filesystem, we need to do reverse
order, so</p>
<ol>
<li>
<p>umount /dev/vg_apol/lv_root <em>unmount volume</em></p>
</li>
<li>
<p>vgchange -an vg_apol <em>remove logical volume devices</em>
0 logical volume(s) in volume group &ldquo;vg_apol&rdquo; now active</p>
</li>
<li>
<p>kpartx -d /dev/loop6 <em>remove /dev mapper partitions</em></p>
</li>
<li>
<p>losetup -d /dev/loop6 <em>&ldquo;dettach&rdquo; the loopback device</em></p>
</li>
</ol>

        </div>
      </article>

      <hr />

      <div class="post-info">
        
        

        <p>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
          309 Words
        </p>

        <p>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          
            2019-04-01 16:58
          

           
            
          
        </p>
      </div>

      
    <div class="pagination">
        
        <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
        </div>
        

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://apostoloss.github.io/BitsThoughtsAndMore/posts/blogging_with_hugo/">
                    <span class="button__icon">←</span>
                    <span class="button__text">Blogging with Hugo</span>
                </a>
            </span>
            

            
        </div>
    </div>


      

      

      

    </main>
  </div>


            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/BitsThoughtsAndMore/bundle.min.08b680078a3cf9c69e3dd217a5aa52cfddd4a1d850f8cdff127fdd7421a71f8b2b474be69386f67819edace92273916e7230c9054f38107db9dc6730b3530ab5.js" integrity="sha512-CLaAB4o8&#43;caePdIXpapSz93UodhQ&#43;M3/En/ddCGnH4srR0vmk4b2eBntrOkic5FucjDJBU84EH253Gcws1MKtQ=="></script>




    </body>
</html>
